name: üéµ Deploy Suno Prompt Generator

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: üéâ Deploy para /suno-prompt/
    runs-on: ubuntu-latest
    
    steps:
      - name: üöö Baixar c√≥digo
        uses: actions/checkout@v4
      
      - name: ‚úÖ Verificar secrets configurados
        run: |
          echo "üîç Verificando configura√ß√£o de secrets..."
          if [ -z "${{ secrets.FTP_USERNAME }}" ]; then
            echo "‚ùå ERRO: Secret FTP_USERNAME n√£o configurado!"
            echo "üìù Configure em: Settings > Secrets and variables > Actions"
            echo "   Nome: FTP_USERNAME"
            echo "   Valor: arquivos@linuxgo.com.br"
            exit 1
          fi
          
          if [ -z "${{ secrets.FTP_PASSWORD }}" ]; then
            echo "‚ùå ERRO: Secret FTP_PASSWORD n√£o configurado!"
            exit 1
          fi
          
          echo "‚úÖ Secrets configurados corretamente!"
          echo "üë§ Usu√°rio: ${{ secrets.FTP_USERNAME }}"
      
      - name: üîç Descobrir servidor correto
        id: find-server
        run: |
          servers=("linuxgo.com.br" "1gigahost.com.br" "ftp.1gigahost.com.br")
          
          for server in "${servers[@]}"; do
            echo "Testando: $server"
            if nslookup $server > /dev/null 2>&1; then
              echo "‚úÖ DNS OK para: $server"
              echo "server=$server" >> $GITHUB_OUTPUT
              break
            else
              echo "‚ùå DNS falhou para: $server"
            fi
          done
          
          if [ -z "$(cat $GITHUB_OUTPUT)" ]; then
            echo "‚ùå Nenhum servidor FTP encontrado!"
            echo "üîß Configure o secret FTP_SERVER manualmente"
            exit 1
          fi
      
      - name: üìÇ Deploy via FTP
        if: steps.find-server.outputs.server
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ steps.find-server.outputs.server }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: 21
          protocol: ftp
          server-dir: /suno-prompt/
